<div class="container-wrapper" fxLayout="row" fxLayoutAlign="center center">
  <div fxLayout="column" fxFlex="100%" fxFlex.gt-sm="600px">

    <form #clienteForm="ngForm" (ngSubmit)="salvar(clienteForm)">

      <mat-card class="form-card">
        <mat-card-header class="form-header">
          <mat-card-title class="form-title">
            <mat-icon class="title-icon">person_add</mat-icon>
            Cadastro de Cliente
          </mat-card-title>
          <mat-card-subtitle class="form-subtitle">
            <mat-icon class="subtitle-icon">info</mat-icon>
            Preencha todos os campos obrigatórios (*)
          </mat-card-subtitle>
        </mat-card-header>

        <mat-divider></mat-divider>

        <mat-card-content class="form-content">
          <div fxLayout="column">

            <!-- Nome -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Nome completo</mat-label>
              <input type="text" matInput [(ngModel)]="cliente.nome" name="nome" #nome="ngModel" required/>
              <mat-icon matPrefix class="field-icon">person</mat-icon>
              @if (nome.invalid && nome.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  Nome é obrigatório
                </mat-error>
              }
            </mat-form-field>

            <!-- Email -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>E-mail</mat-label>
              <input type="email" matInput [(ngModel)]="cliente.email" name="email" #email="ngModel" required/>
              <mat-icon matPrefix class="field-icon">email</mat-icon>
              @if (email.invalid && email.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  Digite um e-mail válido
                </mat-error>
              }
            </mat-form-field>

            <!-- CPF -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>CPF</mat-label>
              <input type="text" matInput mask="000.000.000-00" [dropSpecialCharacters]="false" [(ngModel)]="cliente.cpf" name="cpf" #cpf="ngModel" required/>
              <mat-icon matPrefix class="field-icon">badge</mat-icon>
              @if (cpf.invalid && cpf.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  CPF é obrigatório
                </mat-error>
              }
            </mat-form-field>

            <!-- Data de Nascimento -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Data de Nascimento</mat-label>
              <input type="text" matInput mask="00/00/0000" [dropSpecialCharacters]="false" [(ngModel)]="cliente.dataNascimento" name="dataNascimento" #dataNascimento="ngModel" required/>
              <mat-icon matPrefix class="field-icon">calendar_today</mat-icon>
              @if (dataNascimento.invalid && dataNascimento.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  Data de nascimento é obrigatória
                </mat-error>
              }
            </mat-form-field>

            <!-- UF -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>UF</mat-label>
              <input  matInput name="uf"  [(ngModel)]="cliente.uf" (ngModelChange)="filtrarUF($event); carregarMunicipios($event)" [matAutocomplete]="auto" required #uf="ngModel"/>
              <mat-icon matPrefix class="field-icon">location_on</mat-icon>
              <mat-autocomplete #auto="matAutocomplete">
                <mat-option *ngFor="let uf of filteredEstados" [value]="uf.sigla">
                  {{ uf.sigla }} - {{ uf.nome }}
                </mat-option>
              </mat-autocomplete>
              @if (uf.invalid && uf.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  UF é obrigatória
                </mat-error>
              }
            </mat-form-field>

            <!-- Município -->
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Municípios</mat-label>
              <input matInput name="municipio" [(ngModel)]="cliente.municipio" (ngModelChange)="filtrarMunicipios($event)" [matAutocomplete]="autoMunicipio" required #municipio="ngModel"/>
              <mat-icon matPrefix class="field-icon">location_city</mat-icon>
              
              <mat-autocomplete #autoMunicipio="matAutocomplete">
                <mat-option *ngFor="let municipio of filteredMunicipios" [value]="municipio.nome">
                  {{ municipio.nome }}
                </mat-option>
              </mat-autocomplete>
              
              @if (municipio.invalid && municipio.touched) {
                <mat-error class="field-error">
                  <mat-icon>error</mat-icon>
                  Município é obrigatório
                </mat-error>
              }
            </mat-form-field>

          </div>
        </mat-card-content>

        <mat-divider></mat-divider>

        <mat-card-actions class="form-actions" align="end">
          <button mat-stroked-button type="button" color="warn" class="action-btn"(click)="limparFormulario(clienteForm)">
            <mat-icon>clear</mat-icon>
            Limpar
          </button>

          @if (!atualizando) {
            <button mat-raised-button color="primary" type="submit" class="action-btn"[disabled]="clienteForm.invalid">
              <mat-icon>save</mat-icon>
              Salvar
            </button>
          } @else {
            <button mat-raised-button color="accent" type="submit" class="action-btn"[disabled]="clienteForm.invalid">
              <mat-icon>update</mat-icon>
              Atualizar
            </button>
          }
        </mat-card-actions>
      </mat-card>
    </form>
  </div>
</div>